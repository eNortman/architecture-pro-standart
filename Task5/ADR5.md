### <a name="_b7urdng99y53"></a>**Название задачи:** Заявка на кредит онлайн
### <a name="_hjk0fkfyohdk"></a>**Автор:**
### <a name="_uanumrh8zrui"></a>**Дата:**
### <a name="_3bfxc9a45514"></a>**Функциональные требования**
Опишите здесь верхнеуровневые Use Cases. Их нужно оформить в виде таблицы с пошаговым описанием:

|**№**|**Действующие лица или системы**|**Use Case**|**Описание**|
| :-: | :- | :- | :- |
| UC1 | клиент на сайте | 1. клиент выбирает на сайте из списка доступных варинтов кредитных продуктов интересующий его <br> 2. заполняет форму заявки на кредит заполнив обязателные поля (тел, Ф.И.О.) и по-желанию необязательные (паспортные данные)  <br> 3. Клиенту отображается информация об БКИ <br> 4. Клиент отправляет заявку (Submit) <br> 5. Клиенту послупает СМС с информацией, что нужно пройти идентификацию||
| UC2 |  менеджер фронт-офиса | 1. менеджер заполняет и подает заявку через АБС <br> 2. В АБС проверяется наличие заявки, поданной с сайта или создается новая  <br> ||
| UC3 | клиент в интернет-банке | 1. клиент на странице достпных кредитов и предобобренных предложений выбирает интересующее <br> 2. Клиент заполняет форму заявки, указывая данные для заявки и отправляет ее <br> 3. Клиенту поступает СМС сообщение с кодом проверки  <br> 4. Клиент вводит код, подтверждая создание заявки на кредит <br> 5. Клиенту отображается информация о данных созданной заявки ||

### <a name="_u8xz25hbrgql"></a>**Нефункциональные требования**
|**№**|**Требование**|
| :-: | :- |
|**R**|**Надежность**|
|  | Избегать прямой работы интернет-банка с API АБС |
|  | Обеспечить доступность сервисов даже в отсутствии работы АБС |
|  | Обеспечить доступность сервисов при сбое ЦОД |
|**Р**|**Производительность**|
|  | Загрузка за несколько мс |
|**R**|**Ограничения**|
|  | Использовать имеющийся стек АБС <br> - Delphi + Oracle - логика на PL/SQL <br> - Сайт - PHP + React <br>  - Интернет-банк ASP.NET MVC 4.5 + MSSQL <br> - есть система на Java + Spring Boot|

### <a name="_qmphm5d6rvi3"></a>**Решение**


```plantuml
@startuml
title рис1. оформление кредита - диаграмма контекста 
top to bottom direction

!includeurl https://raw.githubusercontent.com/RicardoNiepel/C4-PlantUML/master/C4_Component.puml

Person_Ext(user, "Пользователь", "Клиент банка")
Person(operbo, "Оператор", "Сотрудник бэк-офиса")
Person(operfo, "Оператор", "Сотрудник фронт-офиса")

System(site, "Сайт")
System(dbank, "Интернет-банк")
System(abs, "АБС")
System(sms, "Шлюз телеком-оператора")
System(crdconv, "Кредитный конвейер")
System_Ext(bki, "Бюро Кредитных Истории")

Rel(user, site, "заявка от неавторизованного пользователя")
Rel(user, dbank, "заявка от авторизованного пользователя")
Rel(site, dbank, "Передача заявки в и-нет банк")

Rel(dbank, bki, "Запрос предварительной оценки клиента")
Rel(dbank, sms, "Отправка сообщения клиенту")
Rel(sms, user, "Получение сообщения клиентом")

Rel(abs, crdconv, "Размешение заявки для скоринга")

Rel(operfo, abs, "Размешение заявки с данными предварительной оценки от БКИ")
Rel(operbo, abs, "Обработка заявки")
Rel(dbank, abs, "Размешение заявки")
Rel(abs, bki, "Запрос оценки клиента")

@enduml
```

В предлашаемом решении взаимодествие АБС и кредитного конвеера оставлена без изменений.
В предлашаемом решении взаимодествие с системой кредитного конвеера  оставлена без изменений, чтобы сократить объем работы по его модификации.
Для упрощения схемы показан случай принятия решения о реализации интернет-банка совместно с сайтом. Сайт при этом несет на себе функцию web-фронтенда, интернет-банк - backend. 

```plantuml
@startuml
title рис2. оформление кредита - диаграмма контейнеров 
top to bottom direction

!includeurl https://raw.githubusercontent.com/RicardoNiepel/C4-PlantUML/master/C4_Component.puml

Person_Ext(user, "Пользователь", "Клиент банка")

System(front_http, "nginx", "Фронтальный веб-сервер + маршрутизатор + балансир + HTTPS")
System(site, "Сайт", "PHP + ReactJS")


Container_Boundary(ibank_bnd, "Интернет-банк") {

    ContainerDb(ibnk_db, "БД", "MS-SQL", "База данных Интернет-банка")

    Container(ibnk_web_srv, "Интернет Банк API", "Backend сервер интернет-банка")

    Rel(ibnk_web_srv, ibnk_db, "")
    Rel(site, ibnk_web_srv, "использование сайта в качестве клиента интенет-банка")

}

ContainerQueue(qbroker, "Интеграционный брокер", "Kafka", "Интеграция между системами")

Person(operbk, "Оператор", "Сотрудник бэк-офиса")
Person(operfk, "Оператор", "Сотрудник фронт-офиса")

Container_Boundary(abs_bnd, "АБС") {
    Container(absapp, "АБС Клиент", "Delphi Client App", "Клиентской приложение оператора бэк-офиса")
    ContainerDb(abs_db, "БД", "OracleDb", "База данных АБС c логикой")
      
    Container(absapi, "AБС Api","","Сервер интеграции и обработки событий АБС")

    Rel(absapp, abs_db, "")
    Rel(absapi, abs_db, "")
}

Rel(operbk, absapp, "")
Rel(operfk, absapp, "")

System(sms, "Шлюз телеком-оператора")
System(krdscore, "Система кредитного скоринга", "REST API")
System_Ext(bki, "Бюро кредитных историй","")

Rel(ibnk_web_srv, qbroker, "данные заявки и/или команде отправки смс-уведомления" )
Rel(absapi, qbroker, "данные о статусе заявки и/или команде отправки смс-уведомления" )

Rel(user, front_http, "соединение до внутреннего контура банка защищено https")

Rel(front_http, site, "запрос веб-страницы")
Rel(front_http, ibnk_web_srv, "rest-запросы")

Rel(qbroker, sms, "сообщения для отправки")

Rel(ibnk_web_srv, krdscore, "заявление для предварительной оценки заемщика")

Rel(absapi, krdscore, "заявление для оценки заявки")
Rel(krdscore, bki, "")

@enduml
```

### <a name="_bjrr7veeh80c"></a>**Альтернативы**

  Для альтернативы можно представить решение с интеграцией системы кредитного скоринга через Kafka. Но это потребует переработки API этого модуля.

```plantuml
@startuml
title рис3. оформление кредита - диаграмма контейнеров (альтернатива)
top to bottom direction

!includeurl https://raw.githubusercontent.com/RicardoNiepel/C4-PlantUML/master/C4_Component.puml

Person_Ext(user, "Пользователь", "Клиент банка")

System(front_http, "nginx", "Фронтальный веб-сервер + маршрутизатор + балансир + HTTPS")
System(site, "Сайт", "PHP + ReactJS")


Container_Boundary(ibank_bnd, "Интернет-банк") {

    ContainerDb(ibnk_db, "БД", "MS-SQL", "База данных Интернет-банка")

    Container(ibnk_web_srv, "Интернет Банк API", "Backend сервер интернет-банка")

    Rel(ibnk_web_srv, ibnk_db, "")
    Rel(site, ibnk_web_srv, "использование сайта в качестве клиента интенет-банка")

}

ContainerQueue(qbroker, "Интеграционный брокер", "Kafka", "Интеграция между системами")

Person(operbk, "Оператор", "Сотрудник бэк-офиса")
Person(operfk, "Оператор", "Сотрудник фронт-офиса")

Container_Boundary(abs_bnd, "АБС") {
    Container(absapp, "АБС Клиент", "Delphi Client App", "Клиентской приложение оператора бэк-офиса")
    ContainerDb(abs_db, "БД", "OracleDb", "База данных АБС c логикой")
      
    Container(absapi, "AБС Api","","Сервер интеграции и обработки событий АБС")

    Rel(absapp, abs_db, "")
    Rel(absapi, abs_db, "")
}

Rel(operbk, absapp, "")
Rel(operfk, absapp, "")

System(sms, "Шлюз телеком-оператора")
System(krdscore, "Система кредитного скоринга", "Kafka API")
System_Ext(bki, "Бюро кредитных историй","")

Rel(ibnk_web_srv, qbroker, "данные заявки и/или команде отправки смс-уведомления" )
Rel(absapi, qbroker, "данные о статусе заявки и/или команде отправки смс-уведомления, запрос в смсиему кредитного скоринга" )

Rel(user, front_http, "соединение до внутреннего контура банка защищено https")

Rel(front_http, site, "запрос веб-страницы")
Rel(front_http, ibnk_web_srv, "rest-запросы")

Rel(qbroker, sms, "сообщения для отправки")

'Rel(ibnk_web_srv, krdscore, "заявление для предварительной оценки заемщика")

Rel(qbroker, krdscore, "заявление для оценки заявки")
Rel(krdscore, bki, "")

@enduml
```

**Недостатки, ограничения, риски**

- при сильных нагрузках на интернет банк может возникнуть сильная нагрузка на систему кредитного скоринга. Частично решить эту проблему можно путем интеграции системы скоринга через очереди
- могут быть задержки при получении предварительной оценки нового пользователя на сайте и в интернет-банке в случае принятия решения интеграции через очереди
- для организации полноценной интеграции не хвататет данных о работае с кредитным конвеером (примем, что задача передачи данных в него и получения результата решена путен интеграции с АБС или внутрибанковскими процессами)
